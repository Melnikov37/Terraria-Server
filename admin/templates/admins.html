{% extends "base.html" %}
{% block title %}Admin Management — Terraria Admin{% endblock %}

{% block content %}
<div class="page-header">
    <h2>Admin Management</h2>
</div>

<div class="card">
    <div class="card-title">Admin Users</div>
    <table class="table">
        <thead>
            <tr>
                <th>Username</th>
                <th>Role</th>
                <th>Created</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for admin in admins %}
            <tr>
                <td>
                    {{ admin.username }}
                    {% if admin.username == current_user %}
                    <span class="badge badge-info" style="margin-left:5px;">you</span>
                    {% endif %}
                </td>
                <td>
                    <span class="badge {{ 'badge-danger' if admin.role == 'superadmin' else ('badge-warning' if admin.role == 'admin' else 'badge-success') }}">
                        {{ admin.role }}
                    </span>
                </td>
                <td style="color:var(--text-muted); font-size:0.85rem;">{{ admin.created_at }}</td>
                <td>
                    <div class="btn-group">
                        <form method="POST" action="{{ url_for('admins.admins_role') }}" class="inline-form"
                              style="display:inline-flex;gap:5px;align-items:center;">
                            <input type="hidden" name="username" value="{{ admin.username }}">
                            <select name="role" style="padding:4px 8px;font-size:0.8rem;width:auto;">
                                {% for role in roles %}
                                <option value="{{ role }}" {{ 'selected' if role == admin.role }}>{{ role }}</option>
                                {% endfor %}
                            </select>
                            <button type="submit" class="btn btn-primary btn-sm">Set Role</button>
                        </form>

                        {% if admin.username != current_user %}
                        <form method="POST" action="{{ url_for('admins.admins_delete') }}" class="inline-form"
                              onsubmit="return confirm('Delete admin {{ admin.username }}?');">
                            <input type="hidden" name="username" value="{{ admin.username }}">
                            <button type="submit" class="btn btn-danger btn-sm">Delete</button>
                        </form>
                        {% endif %}
                    </div>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<div class="grid grid-2">
    <div class="card">
        <div class="card-title">Add New Admin</div>
        <form method="POST" action="{{ url_for('admins.admins_add') }}">
            <div class="form-group">
                <label>Username</label>
                <input type="text" name="username" required placeholder="username">
            </div>
            <div class="form-group">
                <label>Password</label>
                <input type="password" name="password" required placeholder="min 6 characters">
            </div>
            <div class="form-group">
                <label>Role</label>
                <select name="role">
                    {% for role in roles %}
                    <option value="{{ role }}" {{ 'selected' if role == 'admin' }}>{{ role }}</option>
                    {% endfor %}
                </select>
            </div>
            <button type="submit" class="btn btn-success">Create Admin</button>
        </form>
    </div>

    <div class="card">
        <div class="card-title">Change Password</div>
        <form method="POST" action="{{ url_for('admins.admins_password') }}">
            <div class="form-group">
                <label>Username</label>
                <select name="username">
                    {% for admin in admins %}
                    <option value="{{ admin.username }}" {{ 'selected' if admin.username == current_user }}>
                        {{ admin.username }}
                    </option>
                    {% endfor %}
                </select>
            </div>
            <div class="form-group">
                <label>New Password</label>
                <input type="password" name="password" required placeholder="min 6 characters">
            </div>
            <button type="submit" class="btn btn-warning">Change Password</button>
        </form>
        <p style="color:var(--text-muted); font-size:0.85rem; margin-top:10px;">
            You can always change your own password. Superadmins can change any user's password.
        </p>
    </div>
</div>

<div class="card">
    <div class="card-title">Roles Reference</div>
    <table class="table">
        <tr>
            <td><span class="badge badge-success">viewer</span></td>
            <td>Read-only access — can view dashboards and logs but cannot start/stop server or make changes</td>
        </tr>
        <tr>
            <td><span class="badge badge-warning">admin</span></td>
            <td>Full server management — can start/stop, manage mods, backups, worlds, etc.</td>
        </tr>
        <tr>
            <td><span class="badge badge-danger">superadmin</span></td>
            <td>All admin permissions plus user management (add/delete/modify admins)</td>
        </tr>
    </table>
</div>
{% endblock %}
